!!!
%html
  %head
    %meta{:content => "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
    %meta{:content => "width=device-width, initial-scale=1.0", :name => "viewport"}/
    %link{:href => "/favicons/madhouse/apple-icon-57x57.png", :rel => "apple-touch-icon", :sizes => "57x57"}/
    %link{:href => "/favicons/madhouse//apple-icon-60x60.png", :rel => "apple-touch-icon", :sizes => "60x60"}/
    %link{:href => "/favicons/madhouse//apple-icon-72x72.png", :rel => "apple-touch-icon", :sizes => "72x72"}/
    %link{:href => "/favicons/madhouse//apple-icon-76x76.png", :rel => "apple-touch-icon", :sizes => "76x76"}/
    %link{:href => "/favicons/madhouse//apple-icon-114x114.png", :rel => "apple-touch-icon", :sizes => "114x114"}/
    %link{:href => "/favicons/madhouse//apple-icon-120x120.png", :rel => "apple-touch-icon", :sizes => "120x120"}/
    %link{:href => "/favicons/madhouse//apple-icon-144x144.png", :rel => "apple-touch-icon", :sizes => "144x144"}/
    %link{:href => "/favicons/madhouse//apple-icon-152x152.png", :rel => "apple-touch-icon", :sizes => "152x152"}/
    %link{:href => "/favicons/madhouse//apple-icon-180x180.png", :rel => "apple-touch-icon", :sizes => "180x180"}/
    %link{:href => "/favicons/madhouse//android-icon-192x192.png", :rel => "icon", :sizes => "192x192", :type => "image/png"}/
    %link{:href => "/favicons/madhouse//favicon-32x32.png", :rel => "icon", :sizes => "32x32", :type => "image/png"}/
    %link{:href => "/favicons/madhouse//favicon-96x96.png", :rel => "icon", :sizes => "96x96", :type => "image/png"}/
    %link{:href => "/favicons/madhouse//favicon-16x16.png", :rel => "icon", :sizes => "16x16", :type => "image/png"}/
    %link{:href => "/favicons/madhouse//manifest.json", :rel => "manifest"}/
    %meta{:content => "#ffffff", :name => "msapplication-TileColor"}/
    %meta{:content => "/ms-icon-144x144.png", :name => "msapplication-TileImage"}/
    %meta{:content => "#ffffff", :name => "theme-color"}/
    %meta{property: "fb:app_id", content: Figaro.env.madhouse_facebook_client_id.to_s}
    
    = display_meta_tags :site => 'Mad House Helsinki'
    = stylesheet_link_tag 'madhouse/stylesheets/application', media: 'screen'

    = javascript_include_tag 'madhouse/javascripts/application', 'data-turbolinks-track' => false 
    %script{:src => "https://maps.googleapis.com/maps/api/js?key=#{ENV['GOOGLE_MAPS_API_KEY']}", :type => "text/javascript"}
    = csrf_meta_tags
    %script{:type => "text/javascript"}
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-53860540-1', 'auto');
      ga('send', 'pageview');

  %body
    %header 
      .icons.text-left
        = link_to fa_icon("twitter"), 'http://www.twitter.com/madhousehel', target: :_blank
        = link_to fa_icon("facebook"), 'http://www.facebook.com/madhousehelsinki', target: :_blank
        = link_to fa_icon("instagram"), 'http://www.instagram.com/madhousehelsinki', target: :_blank
        = link_to fa_icon("flickr"), 'https://www.flickr.com/photos/129272798@N06', target: :_blank
        = link_to fa_icon("rss"), '/feed.rss', target: :_blank
      .languages.end
        - if I18n.locale.to_s != 'en'
          = link_to('EN', :controller => controller.controller_name, :action => controller.action_name, :id => params[:id], :locale => 'en')
        - else
          %strong EN
        |
        - if I18n.locale.to_s != 'fi'
          = link_to('FI', :controller => controller.controller_name, :action => controller.action_name, :id => params[:id], :locale => 'fi')
        - else
          %strong FI
        |
        - if I18n.locale.to_s != 'sv'
          = link_to('SV', :controller => controller.controller_name, :action => controller.action_name, :id => params[:id], :locale => 'sv') 
        - else
          %strong SV
      .title.text-center
        - if @event
          = link_to retina_image_tag(theme_image_path("MHH_season#{@event.madhouse_season}.png")), '/'
        - else
          =  link_to retina_image_tag(theme_image_path('madhousebanner.png')), '/'
        -#= link_to fa_icon("bars"), '#', onclick: 'javascript: $(".menu_bar").slideToggle();return false;'
      .menu_bar.visible.text-center.hide-for-small-only
        .menu_items= render partial: 'layouts/top_menu'    
      .menu_select.show-for-small-only
        .row.expanded
          .small-10.columns.menu_items= render partial: 'layouts/mobile_menu'        
    .calendar#calendar_container
      #calendar
  
      .calendar_tab
        = link_to fa_icon("calendar"), '#', onclick: 'javascript:toggleCalendar();return false;'
    #container= yield
    %footer
      .mailing_list
        .row.expanded
          .small-8.medium-8.small-centered.columns
            .row.expanded
              .medium-6.columns.text-center
                .blurb= t "madhouse.join_our_email_list"
              .medium-6.columns.end
                = form_tag url_for('/madhouse/add_to_list'), :id => :email_form, :method => :post, :remote => true do 
                  #loading{:style => 'display: none'}= image_tag(theme_image_path('spinner.gif'))
                  #email_error
                  .email_signup_form   
                    = text_field_tag :email, t("madhouse.enter_your_email_address"), { :class => "clearfield"}
                    = submit_tag t(:join), :class => :email_signup      
      = render partial: 'layouts/footer'

        
  :javascript
    $(document).ready(function() { #{yield :jquery} 
      $("input.clearfield").clearField();
      $('form#email_form').submit(function() {
        $('button.email_signup').attr('disabled', 'disabled');   
        $("#loading").toggle();
      });
               
      $('#calendar').fullCalendar( {
            editable: true,
            header: {
              left: 'prev,next today',
              center: 'title',
              right: 'month,agendaWeek,agendaDay'
            },
            defaultView: 'month',
            contentHeight: '400px',
            lang: '#{I18n.locale.to_s}',
            contentHeight: 'auto',
            firstDay: 1,
            
            fixedWeekCount: false,
            slotMinutes: 30,
            eventSources: [
              {
                url: '/calendar'
              }
            ],
            timeFormat: 'H:mm',
            dragOpacity: "0.5",
            eventDrop: function(event, dayDelta, minuteDelta, allDay, revertFunc) {
              return updateEvent(event);
            },
            eventResize: function(event, dayDelta, minuteDelta, revertFunc) {
              return updateEvent(event);
            }
          });

      $('#calendar').fullCalendar('gotoDate', '2017-01-01');
        updateEvent = function(the_event) {

          return $.update("/calendar/" + the_event.id, {
            event: {
              title: the_event.title,
              starts_at: "" + the_event.start,
              ends_at: "" + the_event.end,
              description: the_event.description
            }
          });
        };

      
    
    
    });