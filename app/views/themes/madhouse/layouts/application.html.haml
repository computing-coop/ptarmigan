!!!
%html
  %head
    %meta{:content => "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
    %meta{:content => "width=device-width, initial-scale=1.0", :name => "viewport"}/
    = display_meta_tags :site => 'Mad House Helsinki'
    = stylesheet_link_tag    'madhouse/stylesheets/application', media: 'screen'
    = javascript_include_tag "vendor/modernizr"
    = javascript_include_tag 'madhouse/javascripts/application', 'data-turbolinks-track' => true 
    %script{:src => "https://maps.googleapis.com/maps/api/js?key=#{ENV['GOOGLE_MAPS_API_KEY']}", :type => "text/javascript"}
    = csrf_meta_tags
    -#%link{:href => "/posts.rss", :rel => "alternate", :title => "RSS", :type => "application/rss+xml"}/

  %body
    %header 
      .icons.text-left
        = link_to fa_icon("twitter"), 'http://www.twitter.com/madhousehel', target: :_blank
        = link_to fa_icon("facebook"), 'http://www.facebook.com/madhousehelsinki', target: :_blank
        = link_to fa_icon("instagram"), 'http://www.instagram.com/madhousehelsinki', target: :_blank
        = link_to fa_icon("flickr"), 'https://www.flickr.com/photos/129272798@N06', target: :_blank
        = link_to fa_icon("rss"), '/feed.rss', target: :_blank
      .languages.end
        - if I18n.locale.to_s != 'en'
          = link_to('EN', :controller => controller.controller_name, :action => controller.action_name, :id => params[:id], :locale => 'en')
        - else
          %strong EN
        |
        - if I18n.locale.to_s != 'fi'
          = link_to('FI', :controller => controller.controller_name, :action => controller.action_name, :id => params[:id], :locale => 'fi')
        - else
          %strong FI
        |
        - if I18n.locale.to_s != 'sv'
          = link_to('SV', :controller => controller.controller_name, :action => controller.action_name, :id => params[:id], :locale => 'sv') 
        - else
          %strong SV
      .title.text-center
        - if @event
          = link_to retina_image_tag(theme_image_path("MHH_season#{@event.madhouse_season}.png")), '/'
        - else
          =  link_to retina_image_tag(theme_image_path('madhousebanner.png')), '/'
        -#= link_to fa_icon("bars"), '#', onclick: 'javascript: $(".menu_bar").slideToggle();return false;'
      .menu_bar.visible.text-center.hide-for-small-only
        .menu_items= render partial: 'layouts/top_menu'    
      .menu_select.show-for-small-only
        .row
          .small-10.columns.menu_items= render partial: 'layouts/mobile_menu'        
    .calendar#calendar_container
      #calendar
  
      .calendar_tab
        = link_to fa_icon("calendar"), '#', onclick: 'javascript:toggleCalendar();return false;'
    #container= yield
    %footer= render partial: 'layouts/footer'

        
  :javascript
    $(document).ready(function() { #{yield :jquery} 
      $('#calendar').fullCalendar({
            editable: true,
            header: {
              left: 'prev,next today',
              center: 'title',
              right: 'month,agendaWeek,agendaDay'
            },
            defaultView: 'month',
            contentHeight: '400px',
            lang: '#{I18n.locale.to_s}',
            contentHeight: 'auto',
            firstDay: 1,
            slotMinutes: 30,
            eventSources: [
              {
                url: '/calendar'
              }
            ],
            timeFormat: 'H:mm',
            dragOpacity: "0.5",
            eventDrop: function(event, dayDelta, minuteDelta, allDay, revertFunc) {
              return updateEvent(event);
            },
            eventResize: function(event, dayDelta, minuteDelta, revertFunc) {
              return updateEvent(event);
            }
          });


        updateEvent = function(the_event) {
          return $.update("/calendar/" + the_event.id, {
            event: {
              title: the_event.title,
              starts_at: "" + the_event.start,
              ends_at: "" + the_event.end,
              description: the_event.description
            }
          });
        };

      
    
    
    });